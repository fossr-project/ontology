@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix rml: <http://semweb.mmlab.be/ns/rml#> .
@prefix ql: <http://semweb.mmlab.be/ns/ql#> .
@prefix ls: <https://w3id.org/fossr/ontology/limesurvey/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

# ============================================
# LOGICAL SOURCE - QUESTIONS
# ============================================

<#QuestionsSource>
  rml:source "questions_only.json" ;
  rml:referenceFormulation ql:JSONPath ;
  rml:iterator "$[*]" .

# ============================================
# MAPPING QUESTIONS
# ============================================

<#QuestionMapping>
  rml:logicalSource <#QuestionsSource> ;

  rr:subjectMap [
    rr:template "https://w3id.org/fossr/data/question_{qid}" ;
    rr:class ls:Question
  ] ;

  # hasId → Identifier
  rr:predicateObjectMap [
    rr:predicate ls:hasId ;
    rr:objectMap [
      rr:template "https://w3id.org/fossr/data/identifier_{qid}_question" ;
      rr:termType rr:IRI
    ]
  ] ;

  # hasVariable → Variable
  rr:predicateObjectMap [
    rr:predicate ls:hasVariable ;
    rr:objectMap [
      rr:template "https://w3id.org/fossr/data/variable_{title}" ;
      rr:termType rr:IRI
    ]
  ] ;

  # hasType → QuestionType
  rr:predicateObjectMap [
    rr:predicate ls:hasType ;
    rr:objectMap [
      rr:template "https://w3id.org/fossr/data/questionType_{type}" ;
      rr:termType rr:IRI
    ]
  ] ;

  # hasGroup → Group
  rr:predicateObjectMap [
    rr:predicate ls:hasGroup ;
    rr:objectMap [
      rr:template "https://w3id.org/fossr/data/questionGroup_{gid}" ;
      rr:termType rr:IRI
    ]
  ] ;

  # hasSurvey → Survey
  rr:predicateObjectMap [
    rr:predicate ls:hasSurvey ;
    rr:objectMap [
      rr:template "https://w3id.org/fossr/data/survey_{sid}" ;
      rr:termType rr:IRI
    ]
  ] ;

  # hasComponentAttribute → ComponentAttribute (base attributes)
  rr:predicateObjectMap [
    rr:predicate ls:hasComponentAttribute ;
    rr:objectMap [
      rr:template "https://w3id.org/fossr/data/attribute_question_{qid}_other" ;
      rr:termType rr:IRI
    ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:hasComponentAttribute ;
    rr:objectMap [
      rr:template "https://w3id.org/fossr/data/attribute_question_{qid}_mandatory" ;
      rr:termType rr:IRI
    ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:hasComponentAttribute ;
    rr:objectMap [
      rr:template "https://w3id.org/fossr/data/attribute_question_{qid}_encrypted" ;
      rr:termType rr:IRI
    ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:hasComponentAttribute ;
    rr:objectMap [
      rr:template "https://w3id.org/fossr/data/attribute_question_{qid}_question_order" ;
      rr:termType rr:IRI
    ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:hasComponentAttribute ;
    rr:objectMap [
      rr:template "https://w3id.org/fossr/data/attribute_question_{qid}_scale_id" ;
      rr:termType rr:IRI
    ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:hasComponentAttribute ;
    rr:objectMap [
      rr:template "https://w3id.org/fossr/data/attribute_question_{qid}_relevance" ;
      rr:termType rr:IRI
    ]
  ] .

# ============================================
# ENTITÀ SUPPORTO
# ============================================

# Identifier
<#QuestionIdMapping>
  rml:logicalSource <#QuestionsSource> ;

  rr:subjectMap [
    rr:template "https://w3id.org/fossr/data/identifier_{qid}_question" ;
    rr:class ls:Identifier
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:id ;
    rr:objectMap [
      rml:reference "qid" ;
      rr:datatype xsd:int
    ]
  ] .

# Variable
<#VariableMapping>
  rml:logicalSource <#QuestionsSource> ;

  rr:subjectMap [
    rr:template "https://w3id.org/fossr/data/variable_{title}" ;
    rr:class ls:Variable
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:variableCod ;
    rr:objectMap [
      rml:reference "title"
    ]
  ] .

# QuestionType
<#QuestionTypeMapping>
  rml:logicalSource <#QuestionsSource> ;

  rr:subjectMap [
    rr:template "https://w3id.org/fossr/data/questionType_{type}" ;
    rr:class ls:QuestionType
  ] .

# Survey
<#SurveyMapping>
  rml:logicalSource <#QuestionsSource> ;

  rr:subjectMap [
    rr:template "https://w3id.org/fossr/data/survey_{sid}" ;
    rr:class ls:Survey
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:hasId ;
    rr:objectMap [
      rr:template "https://w3id.org/fossr/data/identifier_{sid}_survey" ;
      rr:termType rr:IRI
    ]
  ] .

<#SurveyIdMapping>
  rml:logicalSource <#QuestionsSource> ;

  rr:subjectMap [
    rr:template "https://w3id.org/fossr/data/identifier_{sid}_survey" ;
    rr:class ls:Identifier
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:id ;
    rr:objectMap [
      rml:reference "sid" ;
      rr:datatype xsd:int
    ]
  ] .

# Group
<#GroupMapping>
  rml:logicalSource <#QuestionsSource> ;

  rr:subjectMap [
    rr:template "https://w3id.org/fossr/data/questionGroup_{gid}" ;
    rr:class ls:QuestionGroup
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:hasId ;
    rr:objectMap [
      rr:template "https://w3id.org/fossr/data/questionGroup_{gid}_identifier" ;
      rr:termType rr:IRI
    ]
  ] .

<#GroupIdMapping>
  rml:logicalSource <#QuestionsSource> ;

  rr:subjectMap [
    rr:template "https://w3id.org/fossr/data/questionGroup_{gid}_identifier" ;
    rr:class ls:Identifier
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:id ;
    rr:objectMap [
      rml:reference "gid" ;
      rr:datatype xsd:int
    ]
  ] .

# ============================================
# COMPONENT ATTRIBUTES BASE
# ============================================

<#AttributeOtherMapping>
  rml:logicalSource <#QuestionsSource> ;

  rr:subjectMap [
    rr:template "https://w3id.org/fossr/data/attribute_question_{qid}_other" ;
    rr:class ls:ComponentAttribute
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:componentName ;
    rr:objectMap [
      rr:constant "other"
    ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:componentValue ;
    rr:objectMap [
      rml:reference "other"
    ]
  ] .

<#AttributeMandatoryMapping>
  rml:logicalSource <#QuestionsSource> ;

  rr:subjectMap [
    rr:template "https://w3id.org/fossr/data/attribute_question_{qid}_mandatory" ;
    rr:class ls:ComponentAttribute
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:componentName ;
    rr:objectMap [
      rr:constant "mandatory"
    ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:componentValue ;
    rr:objectMap [
      rml:reference "mandatory"
    ]
  ] .

<#AttributeEncryptedMapping>
  rml:logicalSource <#QuestionsSource> ;

  rr:subjectMap [
    rr:template "https://w3id.org/fossr/data/attribute_question_{qid}_encrypted" ;
    rr:class ls:ComponentAttribute
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:componentName ;
    rr:objectMap [
      rr:constant "encrypted"
    ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:componentValue ;
    rr:objectMap [
      rml:reference "encrypted"
    ]
  ] .

<#AttributeQuestionOrderMapping>
  rml:logicalSource <#QuestionsSource> ;

  rr:subjectMap [
    rr:template "https://w3id.org/fossr/data/attribute_question_{qid}_question_order" ;
    rr:class ls:ComponentAttribute
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:componentName ;
    rr:objectMap [
      rr:constant "question_order"
    ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:componentValue ;
    rr:objectMap [
      rml:reference "question_order"
    ]
  ] .

<#AttributeScaleIdMapping>
  rml:logicalSource <#QuestionsSource> ;

  rr:subjectMap [
    rr:template "https://w3id.org/fossr/data/attribute_question_{qid}_scale_id" ;
    rr:class ls:ComponentAttribute
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:componentName ;
    rr:objectMap [
      rr:constant "scale_id"
    ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:componentValue ;
    rr:objectMap [
      rml:reference "scale_id"
    ]
  ] .

<#AttributeRelevanceMapping>
  rml:logicalSource <#QuestionsSource> ;

  rr:subjectMap [
    rr:template "https://w3id.org/fossr/data/attribute_question_{qid}_relevance" ;
    rr:class ls:ComponentAttribute
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:componentName ;
    rr:objectMap [
      rr:constant "relevance"
    ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate ls:componentValue ;
    rr:objectMap [
      rml:reference "relevance"
    ]
  ] .
